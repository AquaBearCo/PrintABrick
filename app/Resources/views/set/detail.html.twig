{% extends 'base.html.twig' %}

{% import 'macros/blocks.html.twig' as blocks %}

{% block title %}{{ set.id }} {{ set.name }}{% endblock %}

{% block header %}{{ set.name | escape('html') }}{% endblock %}

{% block content %}
    <div class="ui stackable grid">
        <div class="column nine wide">
            <a class="ui bordered fluid image" href="{{ asset(set.id~'.jpg')|imagine_filter('set_large') }}" data-lightbox="setImages">
                {{ blocks.setImage(set.id,'set_large') }}
            </a>
        </div>
        <div class="column seven wide">
            <div class="item-info ui">
                <table class="ui very basic table">
                    <tr>
                        <td>{{ 'set.id' | trans }}</td><td><h2>{{ set.id }}</h2></td>
                    </tr>
                    <tr>
                        <td>{{ 'set.name' | trans }}</td><td>{{ set.name }}</td>
                    </tr>
                    <tr>
                        <td>{{ 'set.year' | trans }}</td><td><a href="{{ path('set_index',{'s[year][from]':set.year, 's[year][to]':set.year}) }}">{{ set.year }}</a></td>
                    </tr>
                    <tr>
                        <td>{{ 'set.theme' | trans }}</td>
                        <td><a href="{{ path('set_index',{'s[theme]' : set.theme.id }) }}">{{ set.theme ? set.theme.fullName }}</a></td>
                    </tr>
                    <tr>
                        <td>{{ 'set.parts' | trans }}</td><td>
                            {{ set.partCount~' (Rebrickable)' }}{{ brset and brset.pieces ? ' / '~brset.pieces~' (Brickset)' }}
                        </td>
                    </tr>
                    {% if brset %}
                        {% if brset.minifigs %}
                            <tr>
                                <td>{{ 'set.minifigs' | trans }}</td>
                                <td>{{ brset.minifigs }}</td>
                            </tr>
                        {% endif %}
                        <tr>
                            <td>{{ 'set.rating' | trans }}</td>
                            <td>
                                {{ brset.rating }}/5
                            </td>
                        </tr>
                    {% endif %}
                    <tr>
                        <td></td>
                        <td>
                            <a class="rebrickable link" href="http://rebrickable.com/sets/{{ set ? set.id }}">Rebrickable</a>
                            {% if brset %}
                                <a class="brickset link" href="{{ brset.bricksetURL }}">Brickset</a>
                            {% endif %}
                        </td>
                    </tr>
                </table>


                <div class="ui primary fluid open-modal button">{{ 'set.download.button' | trans }}</div>

                {% embed 'embeds/modal.html.twig' %}
                    {% block title %}
                        {{ 'set.download.title' | trans({'%set%': set.id~' '~set.name}) }}
                    {% endblock %}
                    {% block content %}
                        {% if missingCount > 0 %}
                            <div class="ui warning icon message">
                                <i class="warning icon"></i>
                                <div class="content">
                                    <div class="header">
                                        {{ 'set.download.warning.title' | trans }}
                                    </div>
                                    <p> {{ 'set.download.warning.text' | trans({'%percent%':((1 - missingCount/partCount)*100)|number_format(2, '.', ','), '%total%':partCount, '%missing%': missingCount, '%unique%': uniqueMissing|length}) | raw | nl2br }}</p>
                                </div>
                            </div>
                        {% endif %}
                    {% endblock %}
                    {% block actions %}
                        <div class="ui two column divided center aligned grid">
                            <div class="column">
                                <h4 class="ui header">{{ 'set.download.sorted.title' | trans }}</h4>
                                <p>{{ 'set.download.sorted.text' | trans }}</p>
                                <a class="ui download button" href="{{ path('set_zip', {id: set.id, sorted: true }) }}" download>Download ZIP</a>
                            </div>
                            <div class="column">
                                <h4 class="ui header">{{ 'set.download.unsorted.title' | trans }}</h4>
                                <p>{{ 'set.download.unsorted.text' | trans }}</p>
                                <a class="ui download button" href="{{ path('set_zip', {id: set.id, sorted: false }) }}" download>Download ZIP</a>
                            </div>
                        </div>
                    {% endblock %}
                {% endembed %}
            </div>
        </div>
    </div>

    <div class="ui segment vertical item-info">
        <div class="ui tabular pointing secondary menu">
            <a class="item active" data-tab="inventory"><i class="cubes icon"></i> Inventory ({{ set ? set.partCount : 0}})</a>
            {% if brset %}
                <a class="item" data-tab="description"><i class="info icon"></i> Description</a>
                <a class="item" data-tab="images"> <i class="image icon"></i> Images ({{ brset.additionalImageCount }})</a>
                <a class="item" data-tab="instructions"> <i class="file pdf outline icon"></i> Instructions ({{ brset.instructionsCount }})</a>
                <a class="item" data-tab="reviews"><i class="write icon"></i> Reviews ({{ brset.reviewCount }})</a>
            {% endif %}
        </div>
        <div class="ui vertical segment">
            <div class="ui tab active" data-tab="inventory">

                {#<div class="ui vertical segment">#}
                {#<p>{{ 'set.models.text' | trans({'%rebrickable%' : partCount, '%brickset%' : brset ? brset.pieces }) | nl2br }}</p>#}
                {#</div>#}

                <div class="ui vertical segment">
                    <div class="ui tabular icon buttons submenu">
                        <a class="ui item active button" data-tab="inventory/models"><i class="grid layout icon"></i> Uni-Color</a>
                        <a class="ui item button" data-tab="inventory/colors"><i class="list layout icon"></i> Multi-Color</a>
                    </div>

                    <div class="ui tab active" data-tab="inventory/models">
                        {{ render(path('set_models', {id: set.id})) }}
                    </div>
                    <div class="ui tab" data-tab="inventory/colors">
                        {{ render(path('set_colors', {id: set.id})) }}
                    </div>
                    {{ render(path('set_sets', {id: set.id})) }}
                </div>
            </div>
            {% if brset %}
                <div class="ui tab ajax-load" data-tab="description" data-src="{{ path('brickset_description', { 'id': brset.setID }) }}">
                    <div class="ui active centered inline loader"></div>
                </div>
                <div class="ui tab ajax-load" data-tab="images" data-src="{{ path('brickset_images', { 'id': brset.setID }) }}">
                    <div class="ui active centered inline loader"></div>
                </div>
                <div class="ui tab ajax-load" data-tab="instructions" data-src="{{ path('brickset_instructions', { 'id': brset.setID }) }}">
                    <div class="ui active centered inline loader"></div>
                </div>
                <div class="ui tab ajax-load" data-tab="reviews" data-src="{{ path('brickset_reviews', { 'id': brset.setID }) }}">
                    <div class="ui active centered inline loader"></div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}